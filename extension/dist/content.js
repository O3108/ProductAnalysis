(()=>{"use strict";function e(){return window.location.pathname.includes("/Catalog/Goods/")?function(){const e=[];return document.querySelectorAll(".cell2").forEach(n=>{const c=n.querySelector("a.catheader");if(!c)return;const o=c.querySelector(".wrap p"),i=(o?o.innerText.trim():"").split(/\s+/),u=i.length>0?i[i.length-1]:"",l=i.slice(0,-1).join(" "),a=c.querySelector(".descr span"),s=a?a.innerText.trim():"",p=c.querySelector(".desc.params span"),m=p?p.innerText.trim():"",d=c.querySelector(".ucatprc"),y=d?t(d.innerText):0,S=r(m)||r(s),q=S&&y>0?y/S:void 0;(y>0||l)&&e.push({manufacturer:l,partNumber:u,description:s,supplier:"",price:y,currency:"₽",deliveryDate:"",warehouseType:"",volume:S,pricePerLiter:q})}),e}():function(){const e=[];return document.querySelectorAll(".row-container").forEach(r=>{const n=r.querySelector(".row");if(!n)return;const c=n.querySelector(".art")?.innerText.trim()??"",o=n.querySelector(".partno")?.innerText.trim()??"",i=n.querySelector("a.descr")?.innerText.trim()??"";r.querySelectorAll(".pricerow").forEach(r=>{const n=r.querySelector(".price__wrapper .price"),u=r.querySelector(".provider__name"),l=r.querySelector(".statis a"),a=r.querySelector(".avail .gal"),s=n?t(n.innerText):0,p=u?u.innerText.trim():"",m=l?l.getAttribute("title")??l.innerText.trim():"",d=a?a.getAttribute("title")??"":"";(s>0||c)&&e.push({manufacturer:c,partNumber:o,description:i,supplier:p,price:s,currency:"₽",deliveryDate:m,warehouseType:d})})}),e.length>0?e:function(){const e=[];return document.querySelectorAll(".pricerow").forEach(r=>{const n=r.querySelector(".price__wrapper .price"),c=n?t(n.innerText):0;if(c<=0)return;const o=r.querySelector(".provider__name")?.innerText.trim()??"",i=r.querySelector(".statis a"),u=i?i.getAttribute("title")??i.innerText.trim():"",l=r.querySelector(".avail .gal"),a=l?l.getAttribute("title")??"":"",s=r.closest(".row-container"),p=s?s.querySelector(".art")?.innerText.trim()??"":"",m=s?s.querySelector(".partno")?.innerText.trim()??"":"",d=s?s.querySelector("a.descr")?.innerText.trim()??"":"";e.push({manufacturer:p,partNumber:m,description:d,supplier:o,price:c,currency:"₽",deliveryDate:u,warehouseType:a})}),e}()}()}function r(e){const r=e.match(/([\d.,]+)\s*л(?!\w)/);if(r)return parseFloat(r[1].replace(",","."));const t=e.match(/([\d.,]+)\s*мл(?!\w)/);return t?parseFloat(t[1].replace(",","."))/1e3:void 0}function t(e){const r=e.replace(/\s/g,"").replace("₽","").replace(",",".").match(/[\d]+\.?\d*/);return r?parseFloat(r[0]):0}function n(){if(window.location.pathname.includes("/Catalog/Goods/")){const e=document.querySelectorAll(".cell2"),r=[`cell2 found: ${e.length}`];return e.forEach((e,t)=>{if(t>=3)return;const n=e.querySelector(".wrap p"),c=n?n.innerText.trim():"NOT FOUND",o=e.querySelector(".ucatprc"),i=o?o.innerText.trim():"—",u=e.querySelector(".descr span"),l=u?u.innerText.trim():"—";r.push(`[${t}] ${c} | ${i} | "${l}"`)}),r.join("\n")}const e=document.querySelectorAll(".row-container"),r=[`row-containers found: ${e.length}`];return e.forEach((e,t)=>{if(t>=3)return;const n=e.querySelector(".art")?.innerText.trim()??"NOT FOUND",c=e.querySelector(".partno")?.innerText.trim()??"NOT FOUND",o=e.querySelector("a.descr")?.innerText.trim()??"NOT FOUND",i=e.querySelectorAll(".pricerow");r.push(`[${t}] ${n} ${c} — "${o}" | pricerows: ${i.length}`),i.forEach((e,t)=>{if(t>=2)return;const n=e.querySelector(".price__wrapper .price")?.innerText.trim()??"—",c=e.querySelector(".provider__name")?.innerText.trim()??"—",o=e.querySelector(".statis a")?.getAttribute("title")??"—";r.push(`  pricerow[${t}]: ${n} | ${c} | ${o}`)})}),r.join("\n")}chrome.runtime.onMessage.addListener((r,t,c)=>{if("GET_PRODUCTS"===r.type)return function(r=5e3){return new Promise(t=>{const n=e();if(n.length>0)return void t(n);const c=Date.now()+r,o=new MutationObserver(()=>{const r=e();(r.length>0||Date.now()>c)&&(o.disconnect(),t(r))});o.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{o.disconnect(),t(e())},r)})}().then(e=>{c({products:e,url:window.location.href,title:document.title,debug:n()})}),!0})})();