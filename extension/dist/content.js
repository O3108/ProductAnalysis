(()=>{"use strict";function e(){const e=[];return document.querySelectorAll(".row-container").forEach(t=>{const n=t.querySelector(".row");if(!n)return;const i=n.querySelector(".art")?.innerText.trim()??"",o=n.querySelector(".partno")?.innerText.trim()??"",c=n.querySelector("a.descr")?.innerText.trim()??"";t.querySelectorAll(".pricerow").forEach(t=>{const n=t.querySelector(".price__wrapper .price"),u=t.querySelector(".provider__name"),l=t.querySelector(".statis a"),a=t.querySelector(".avail .gal"),s=n?r(n.innerText):0,p=u?u.innerText.trim():"",y=l?l.getAttribute("title")??l.innerText.trim():"",m=a?a.getAttribute("title")??"":"";(s>0||i)&&e.push({manufacturer:i,partNumber:o,description:c,supplier:p,price:s,currency:"₽",deliveryDate:y,warehouseType:m})})}),e.length>0?e:function(){const e=[];return document.querySelectorAll(".pricerow").forEach(t=>{const n=t.querySelector(".price__wrapper .price"),i=n?r(n.innerText):0;if(i<=0)return;const o=t.querySelector(".provider__name")?.innerText.trim()??"",c=t.querySelector(".statis a"),u=c?c.getAttribute("title")??c.innerText.trim():"",l=t.querySelector(".avail .gal"),a=l?l.getAttribute("title")??"":"",s=t.closest(".row-container"),p=s?s.querySelector(".art")?.innerText.trim()??"":"",y=s?s.querySelector(".partno")?.innerText.trim()??"":"",m=s?s.querySelector("a.descr")?.innerText.trim()??"":"";e.push({manufacturer:p,partNumber:y,description:m,supplier:o,price:i,currency:"₽",deliveryDate:u,warehouseType:a})}),e}()}function r(e){const r=e.replace(/\s/g,"").replace("₽","").replace(",",".").match(/[\d]+\.?\d*/);return r?parseFloat(r[0]):0}function t(){const e=document.querySelectorAll(".row-container"),r=[`row-containers found: ${e.length}`];return e.forEach((e,t)=>{if(t>=3)return;const n=e.querySelector(".art")?.innerText.trim()??"NOT FOUND",i=e.querySelector(".partno")?.innerText.trim()??"NOT FOUND",o=e.querySelector("a.descr")?.innerText.trim()??"NOT FOUND",c=e.querySelectorAll(".pricerow");r.push(`[${t}] ${n} ${i} — "${o}" | pricerows: ${c.length}`),c.forEach((e,t)=>{if(t>=2)return;const n=e.querySelector(".price__wrapper .price")?.innerText.trim()??"—",i=e.querySelector(".provider__name")?.innerText.trim()??"—",o=e.querySelector(".statis a")?.getAttribute("title")??"—";r.push(`  pricerow[${t}]: ${n} | ${i} | ${o}`)})}),r.join("\n")}chrome.runtime.onMessage.addListener((r,n,i)=>{if("GET_PRODUCTS"===r.type)return function(r=5e3){return new Promise(t=>{const n=e();if(n.length>0)return void t(n);const i=Date.now()+r,o=new MutationObserver(()=>{const r=e();(r.length>0||Date.now()>i)&&(o.disconnect(),t(r))});o.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{o.disconnect(),t(e())},r)})}().then(e=>{i({products:e,url:window.location.href,title:document.title,debug:t()})}),!0})})();